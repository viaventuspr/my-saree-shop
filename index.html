<script>
    const sheetID = '1YNPAC7OCg47t-OBKaG91_q39qGU6MePatB8uL-rLVFg';
    // දත්ත කෙලින්ම CSV විදිහට ගමු, එතකොට null ප්‍රශ්නය එන්නේ නැහැ
    const base = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv`;

    function fetchProducts() {
        fetch(base)
            .then(res => res.text())
            .then(csvText => {
                // CSV දත්ත පේළි වලට වෙන් කිරීම
                const rows = csvText.split('\n').map(row => row.split('","').map(cell => cell.replace(/"/g, '')));
                const grid = document.getElementById('productGrid');
                grid.innerHTML = ''; 

                // පළමු පේළිය Header නිසා 1 වෙනි පේළියේ සිට පටන් ගමු
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    
                    // ඔබේ Sheet එකේ පිළිවෙළ: A=Name, B=Price, C=ImageURL නම්:
                    const name = row[0] || "No Name";
                    const price = row[1] || "0.00";
                    const img = row[2] || "";

                    if (img.trim() !== "") {
                        grid.innerHTML += `
                            <div class="product-card">
                                <div class="product-image">
                                    <img src="${img}" alt="${name}" onerror="this.src='https://via.placeholder.com/350?text=Image+Not+Found'">
                                </div>
                                <div class="product-info">
                                    <h3 class="product-name">${name}</h3>
                                    <div class="price">රු. ${price}</div>
                                    <button class="add-to-cart-btn" onclick="orderWhatsApp('${name}', '${price}')">WhatsApp හරහා ඇණවුම් කරන්න</button>
                                </div>
                            </div>
                        `;
                    }
                }
            })
            .catch(err => {
                console.error("Error:", err);
                document.getElementById('productGrid').innerHTML = "Sheet එක සම්බන්ධ කළ නොහැක. Share settings පරීක්ෂා කරන්න.";
            });
    }

    function orderWhatsApp(name, price) {
        const phone = "94771234567"; 
        const message = `ආයුබෝවන්! මට මෙම සාරිය ඇණවුම් කිරීමට අවශ්‍යයි:%0Aසාරිය: ${name}%0Aමිල: රු. ${price}`;
        window.open(`https://wa.me/${phone}?text=${message}`, '_blank');
    }

    window.onload = fetchProducts;
</script>
